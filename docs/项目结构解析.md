# HeartSave é¡¹ç›®ç»“æ„è§£æ

## é¡¹ç›®æ¦‚è¿°

**HeartSave** æ˜¯ä¸€ä¸ªåŸºäº Kotlin Multiplatform æŠ€æœ¯çš„è·¨å¹³å°é¡¹ç›®ï¼Œæ”¯æŒä»¥ä¸‹å¹³å°ï¼š
- ğŸ¤– Android
- ğŸ iOS
- ğŸŒ Web (JS/Wasm)
- ğŸ’» Desktop (JVM)
- ğŸ–¥ï¸ Server (Ktor)

é¡¹ç›®é‡‡ç”¨ Compose Multiplatform æ„å»º UIï¼Œå®ç°ä¸€å¥—ä»£ç å¤šå¹³å°è¿è¡Œçš„ç›®æ ‡ã€‚

---

## é¡¹ç›®æ¶æ„

```
HeartSave/
â”œâ”€â”€ composeApp/          # Compose Multiplatform åº”ç”¨ä¸»æ¨¡å—
â”œâ”€â”€ shared/              # å…±äº«ä¸šåŠ¡é€»è¾‘æ¨¡å—
â”œâ”€â”€ server/              # Ktor æœåŠ¡å™¨æ¨¡å—
â”œâ”€â”€ iosApp/              # iOS åŸç”Ÿåº”ç”¨å…¥å£
â”œâ”€â”€ gradle/              # Gradle é…ç½®å’Œä¾èµ–ç®¡ç†
â”œâ”€â”€ build.gradle.kts     # æ ¹é¡¹ç›®æ„å»ºé…ç½®
â”œâ”€â”€ settings.gradle.kts  # é¡¹ç›®è®¾ç½®å’Œæ¨¡å—åŒ…å«
â””â”€â”€ docs/                # é¡¹ç›®æ–‡æ¡£
```

---

## æ¨¡å—è¯¦è§£

### 1. composeApp/ - Compose Multiplatform åº”ç”¨æ¨¡å—

**èŒè´£**ï¼šåŒ…å«æ‰€æœ‰å¹³å°çš„ UI ä»£ç å’Œå¹³å°ç‰¹å®šçš„å…¥å£ç‚¹

**ç›®å½•ç»“æ„**ï¼š
```
composeApp/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ commonMain/          # æ‰€æœ‰å¹³å°å…±äº«çš„ä»£ç 
â”‚   â”‚   â”œâ”€â”€ kotlin/          # å…±äº«çš„ Kotlin ä»£ç 
â”‚   â”‚   â”‚   â””â”€â”€ com/tcm/heartsave/
â”‚   â”‚   â”‚       â””â”€â”€ App.kt   # ä¸»åº”ç”¨ UI ç»„ä»¶
â”‚   â”‚   â””â”€â”€ composeResources/ # å…±äº«èµ„æºï¼ˆå›¾ç‰‡ã€å­—ç¬¦ä¸²ç­‰ï¼‰
â”‚   â”‚
â”‚   â”œâ”€â”€ androidMain/         # Android å¹³å°ç‰¹å®šä»£ç 
â”‚   â”‚   â”œâ”€â”€ kotlin/          # Android å…¥å£ç‚¹
â”‚   â”‚   â”œâ”€â”€ res/             # Android èµ„æºæ–‡ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ drawable/    # å›¾æ ‡å’Œå›¾ç‰‡
â”‚   â”‚   â”‚   â”œâ”€â”€ mipmap-*/    # åº”ç”¨å›¾æ ‡ï¼ˆä¸åŒåˆ†è¾¨ç‡ï¼‰
â”‚   â”‚   â”‚   â””â”€â”€ values/      # å­—ç¬¦ä¸²ã€é¢œè‰²ç­‰èµ„æº
â”‚   â”‚   â””â”€â”€ AndroidManifest.xml
â”‚   â”‚
â”‚   â”œâ”€â”€ iosMain/             # iOS å¹³å°ç‰¹å®šä»£ç 
â”‚   â”‚   â””â”€â”€ kotlin/          # iOS å…¥å£ç‚¹
â”‚   â”‚
â”‚   â”œâ”€â”€ jvmMain/             # Desktop (JVM) å¹³å°ç‰¹å®šä»£ç 
â”‚   â”‚   â””â”€â”€ kotlin/          # Desktop å…¥å£ç‚¹ï¼ˆMain.ktï¼‰
â”‚   â”‚
â”‚   â”œâ”€â”€ webMain/             # Web å¹³å°ç‰¹å®šä»£ç 
â”‚   â”‚   â”œâ”€â”€ kotlin/          # Web å…¥å£ç‚¹
â”‚   â”‚   â””â”€â”€ resources/       # Web èµ„æºï¼ˆHTMLã€CSSï¼‰
â”‚   â”‚
â”‚   â””â”€â”€ commonTest/          # å…±äº«æµ‹è¯•ä»£ç 
â”‚       â””â”€â”€ kotlin/
â”‚
â”œâ”€â”€ build.gradle.kts         # æ¨¡å—æ„å»ºé…ç½®
â””â”€â”€ webpack.config.d/        # Webpack é…ç½®ï¼ˆç”¨äº Web æ„å»ºï¼‰
```

**å…³é”®é…ç½®**ï¼š
- **å‘½åç©ºé—´**ï¼š`com.tcm.heartsave`
- **åº”ç”¨ ID**ï¼š`com.tcm.heartsave`
- **æ”¯æŒçš„å¹³å°**ï¼š
  - Android (minSdk: 24, targetSdk: 36)
  - iOS (arm64, simulator arm64)
  - JVM (Desktop)
  - JS (æµè§ˆå™¨)
  - WasmJs (ç°ä»£æµè§ˆå™¨)

**ä¸»è¦ä¾èµ–**ï¼š
- Compose Multiplatform (UI æ¡†æ¶)
- Material3 (è®¾è®¡ç³»ç»Ÿ)
- Lifecycle (ViewModel æ”¯æŒ)
- shared æ¨¡å—ï¼ˆä¸šåŠ¡é€»è¾‘ï¼‰

---

### 2. shared/ - å…±äº«ä¸šåŠ¡é€»è¾‘æ¨¡å—

**èŒè´£**ï¼šåŒ…å«æ‰€æœ‰å¹³å°å…±äº«çš„ä¸šåŠ¡é€»è¾‘ã€æ•°æ®æ¨¡å‹å’Œå·¥å…·ç±»

**ç›®å½•ç»“æ„**ï¼š
```
shared/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ commonMain/          # æ‰€æœ‰å¹³å°å…±äº«çš„ä»£ç 
â”‚   â”‚   â””â”€â”€ kotlin/com/tcm/heartsave/
â”‚   â”‚       â”œâ”€â”€ Greeting.kt      # ç¤ºä¾‹ä¸šåŠ¡é€»è¾‘ç±»
â”‚   â”‚       â”œâ”€â”€ Platform.kt      # å¹³å°æŠ½è±¡æ¥å£
â”‚   â”‚       â””â”€â”€ Constants.kt     # å¸¸é‡å®šä¹‰
â”‚   â”‚
â”‚   â”œâ”€â”€ androidMain/         # Android å¹³å°å®ç°
â”‚   â”‚   â””â”€â”€ kotlin/com/tcm/heartsave/
â”‚   â”‚       â””â”€â”€ Platform.android.kt
â”‚   â”‚
â”‚   â”œâ”€â”€ iosMain/             # iOS å¹³å°å®ç°
â”‚   â”‚   â””â”€â”€ kotlin/com/tcm/heartsave/
â”‚   â”‚       â””â”€â”€ Platform.ios.kt
â”‚   â”‚
â”‚   â”œâ”€â”€ jvmMain/             # JVM å¹³å°å®ç°
â”‚   â”‚   â””â”€â”€ kotlin/com/tcm/heartsave/
â”‚   â”‚       â””â”€â”€ Platform.jvm.kt
â”‚   â”‚
â”‚   â”œâ”€â”€ jsMain/              # JS å¹³å°å®ç°
â”‚   â”‚   â””â”€â”€ kotlin/com/tcm/heartsave/
â”‚   â”‚       â””â”€â”€ Platform.js.kt
â”‚   â”‚
â”‚   â”œâ”€â”€ wasmJsMain/          # WasmJs å¹³å°å®ç°
â”‚   â”‚   â””â”€â”€ kotlin/com/tcm/heartsave/
â”‚   â”‚       â””â”€â”€ Platform.wasmJs.kt
â”‚   â”‚
â”‚   â””â”€â”€ commonTest/          # å…±äº«æµ‹è¯•ä»£ç 
â”‚       â””â”€â”€ kotlin/com/tcm/heartsave/
â”‚           â””â”€â”€ SharedCommonTest.kt
â”‚
â””â”€â”€ build.gradle.kts         # æ¨¡å—æ„å»ºé…ç½®
```

**è®¾è®¡æ¨¡å¼**ï¼š
- ä½¿ç”¨ `expect/actual` æœºåˆ¶å®ç°å¹³å°ç‰¹å®šåŠŸèƒ½
- `commonMain` å®šä¹‰æ¥å£ï¼Œå„å¹³å°å®ç°å…·ä½“é€»è¾‘

**å…³é”®ç‰¹æ€§**ï¼š
- è·¨å¹³å°ä¸šåŠ¡é€»è¾‘å°è£…
- å¹³å°æŠ½è±¡å±‚ï¼ˆPlatform æ¥å£ï¼‰
- å¯è¢« composeApp å’Œ server æ¨¡å—å…±åŒä½¿ç”¨

---

### 3. server/ - Ktor æœåŠ¡å™¨æ¨¡å—

**èŒè´£**ï¼šæä¾›åç«¯ API æœåŠ¡

**ç›®å½•ç»“æ„**ï¼š
```
server/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main/
â”‚   â”‚   â”œâ”€â”€ kotlin/com/tcm/heartsave/
â”‚   â”‚   â”‚   â””â”€â”€ Application.kt    # Ktor åº”ç”¨å…¥å£å’Œè·¯ç”±é…ç½®
â”‚   â”‚   â””â”€â”€ resources/
â”‚   â”‚       â””â”€â”€ logback.xml        # æ—¥å¿—é…ç½®
â”‚   â”‚
â”‚   â””â”€â”€ test/
â”‚       â””â”€â”€ kotlin/com/tcm/heartsave/
â”‚           â””â”€â”€ ApplicationTest.kt # æœåŠ¡å™¨æµ‹è¯•
â”‚
â””â”€â”€ build.gradle.kts         # æ¨¡å—æ„å»ºé…ç½®
```

**å…³é”®é…ç½®**ï¼š
- **ä¸»ç±»**ï¼š`com.tcm.heartsave.ApplicationKt`
- **æœåŠ¡å™¨**ï¼šNetty
- **ç«¯å£**ï¼šé€šè¿‡ `shared` æ¨¡å—çš„ `Constants` å®šä¹‰
- **ä¾èµ–**ï¼š
  - Ktor Server Core
  - Ktor Server Netty
  - Logback (æ—¥å¿—)
  - shared æ¨¡å—ï¼ˆå…±äº«ä¸šåŠ¡é€»è¾‘ï¼‰

**å½“å‰åŠŸèƒ½**ï¼š
- æ ¹è·¯å¾„ `/` è¿”å›é—®å€™ä¿¡æ¯
- ä½¿ç”¨ shared æ¨¡å—çš„ `Greeting` ç±»

---

### 4. iosApp/ - iOS åŸç”Ÿåº”ç”¨

**èŒè´£**ï¼šiOS å¹³å°çš„åŸç”Ÿåº”ç”¨å…¥å£å’Œé…ç½®

**ç›®å½•ç»“æ„**ï¼š
```
iosApp/
â”œâ”€â”€ iosApp/                 # iOS åº”ç”¨ä¸»ç›®å½•
â”‚   â”œâ”€â”€ Assets.xcassets/    # iOS èµ„æºæ–‡ä»¶
â”‚   â”œâ”€â”€ ContentView.swift   # SwiftUI è§†å›¾ï¼ˆå¯é€‰ï¼‰
â”‚   â”œâ”€â”€ Info.plist          # iOS åº”ç”¨é…ç½®
â”‚   â”œâ”€â”€ iOSApp.swift        # iOS åº”ç”¨å…¥å£
â”‚   â””â”€â”€ Preview Content/    # SwiftUI é¢„è§ˆèµ„æº
â”‚
â”œâ”€â”€ Configuration/
â”‚   â””â”€â”€ Config.xcconfig     # Xcode é…ç½®æ–‡ä»¶
â”‚
â””â”€â”€ iosApp.xcodeproj/       # Xcode é¡¹ç›®æ–‡ä»¶
```

**è¯´æ˜**ï¼š
- å³ä½¿ä½¿ç”¨ Compose Multiplatformï¼Œä»éœ€è¦æ­¤ç›®å½•ä½œä¸º iOS åº”ç”¨å…¥å£
- å¯ä»¥åœ¨æ­¤æ·»åŠ  SwiftUI ä»£ç 
- é€šè¿‡ Xcode æ‰“å¼€ `iosApp.xcodeproj` è¿›è¡Œ iOS å¼€å‘

---

### 5. gradle/ - Gradle é…ç½®

**ç›®å½•ç»“æ„**ï¼š
```
gradle/
â”œâ”€â”€ libs.versions.toml       # ä¾èµ–ç‰ˆæœ¬ç®¡ç†ï¼ˆç‰ˆæœ¬ç›®å½•ï¼‰
â””â”€â”€ wrapper/                 # Gradle Wrapper
    â”œâ”€â”€ gradle-wrapper.jar
    â””â”€â”€ gradle-wrapper.properties
```

**å…³é”®æ–‡ä»¶**ï¼š
- `libs.versions.toml`ï¼šç»Ÿä¸€ç®¡ç†æ‰€æœ‰ä¾èµ–ç‰ˆæœ¬
  - `[versions]`ï¼šç‰ˆæœ¬å·å®šä¹‰
  - `[libraries]`ï¼šåº“ä¾èµ–å®šä¹‰
  - `[plugins]`ï¼šæ’ä»¶å®šä¹‰

**ä¸»è¦ç‰ˆæœ¬**ï¼š
- Kotlin: 2.2.20
- Compose Multiplatform: 1.9.1
- Ktor: 3.3.1
- Android Gradle Plugin: 8.11.2
- Android Compile SDK: 36
- Android Min SDK: 24

---

## æ„å»ºé…ç½®

### æ ¹çº§é…ç½®æ–‡ä»¶

#### `settings.gradle.kts`
- å®šä¹‰é¡¹ç›®åç§°ï¼š`HeartSave`
- åŒ…å«çš„æ¨¡å—ï¼š`composeApp`ã€`server`ã€`shared`
- å¯ç”¨ç±»å‹å®‰å…¨çš„é¡¹ç›®è®¿é—®å™¨
- é…ç½®æ’ä»¶å’Œä¾èµ–ä»“åº“

#### `build.gradle.kts`
- å£°æ˜æ‰€æœ‰æ’ä»¶ï¼ˆä¸åº”ç”¨ï¼Œä¾›å­æ¨¡å—ä½¿ç”¨ï¼‰
- åŒ…æ‹¬ï¼š
  - Android æ’ä»¶
  - Compose Multiplatform æ’ä»¶
  - Kotlin Multiplatform æ’ä»¶
  - Ktor æ’ä»¶

---

## ä»£ç ç»„ç»‡åŸåˆ™

### 1. å¹³å°ç‰¹å®šä»£ç åˆ†ç¦»
- **commonMain**ï¼šæ‰€æœ‰å¹³å°å…±äº«ä»£ç 
- **platformMain**ï¼šå„å¹³å°ç‰¹å®šå®ç°ï¼ˆandroidMainã€iosMainã€jvmMainã€jsMainã€wasmJsMainï¼‰

### 2. expect/actual æœºåˆ¶
- `expect` åœ¨ `commonMain` ä¸­å£°æ˜
- `actual` åœ¨å„å¹³å°å®ç°ä¸­æä¾›å…·ä½“å®ç°

### 3. æ¨¡å—èŒè´£åˆ’åˆ†
- **composeApp**ï¼šUI å±‚
- **shared**ï¼šä¸šåŠ¡é€»è¾‘å±‚
- **server**ï¼šåç«¯æœåŠ¡å±‚

---

## æ„å»ºå’Œè¿è¡Œ

### Android
```bash
./gradlew :composeApp:assembleDebug
```

### Desktop (JVM)
```bash
./gradlew :composeApp:run
```

### Web (Wasm)
```bash
./gradlew :composeApp:wasmJsBrowserDevelopmentRun
```

### Web (JS)
```bash
./gradlew :composeApp:jsBrowserDevelopmentRun
```

### Server
```bash
./gradlew :server:run
```

### iOS
åœ¨ Xcode ä¸­æ‰“å¼€ `iosApp/iosApp.xcodeproj` å¹¶è¿è¡Œ

---

## æŠ€æœ¯æ ˆ

### æ ¸å¿ƒæ¡†æ¶
- **Kotlin Multiplatform**ï¼šè·¨å¹³å°ä»£ç å…±äº«
- **Compose Multiplatform**ï¼šè·¨å¹³å° UI æ¡†æ¶
- **Ktor**ï¼šå¼‚æ­¥ Web æ¡†æ¶ï¼ˆæœåŠ¡å™¨ï¼‰

### UI ç»„ä»¶
- **Material3**ï¼šMaterial Design 3 ç»„ä»¶åº“
- **Compose Foundation**ï¼šåŸºç¡€ç»„ä»¶
- **Compose UI**ï¼šUI å·¥å…·åŒ…

### å…¶ä»–å·¥å…·
- **Gradle**ï¼šæ„å»ºå·¥å…·
- **Kotlin Coroutines**ï¼šå¼‚æ­¥ç¼–ç¨‹
- **Logback**ï¼šæ—¥å¿—æ¡†æ¶

---

## åŒ…ç»“æ„

æ‰€æœ‰ä»£ç éµå¾ªç»Ÿä¸€çš„åŒ…ç»“æ„ï¼š
```
com.tcm.heartsave
â”œâ”€â”€ App.kt              # Compose UI ä¸»ç»„ä»¶
â”œâ”€â”€ Greeting.kt         # ä¸šåŠ¡é€»è¾‘ç¤ºä¾‹
â”œâ”€â”€ Platform.kt         # å¹³å°æŠ½è±¡
â””â”€â”€ Constants.kt        # å¸¸é‡å®šä¹‰
```

---

## å¼€å‘å»ºè®®

1. **æ–°å¢åŠŸèƒ½**ï¼š
   - UI ç›¸å…³ â†’ `composeApp/src/commonMain`
   - ä¸šåŠ¡é€»è¾‘ â†’ `shared/src/commonMain`
   - å¹³å°ç‰¹å®š â†’ å¯¹åº”çš„ `platformMain` ç›®å½•

2. **å¹³å°ç‰¹å®šå®ç°**ï¼š
   - ä½¿ç”¨ `expect/actual` æœºåˆ¶
   - åœ¨ `commonMain` å®šä¹‰æ¥å£
   - åœ¨å„å¹³å°å®ç°å…·ä½“é€»è¾‘

3. **æµ‹è¯•**ï¼š
   - å…±äº«æµ‹è¯•ä»£ç æ”¾åœ¨ `commonTest`
   - å¹³å°ç‰¹å®šæµ‹è¯•æ”¾åœ¨å¯¹åº”çš„ `platformTest`

4. **èµ„æºç®¡ç†**ï¼š
   - å…±äº«èµ„æº â†’ `composeApp/src/commonMain/composeResources`
   - Android èµ„æº â†’ `composeApp/src/androidMain/res`
   - Web èµ„æº â†’ `composeApp/src/webMain/resources`

---

## é¡¹ç›®çŠ¶æ€

å½“å‰é¡¹ç›®å¤„äºåˆå§‹é˜¶æ®µï¼ŒåŒ…å«ï¼š
- âœ… åŸºç¡€é¡¹ç›®ç»“æ„æ­å»ºå®Œæˆ
- âœ… å¤šå¹³å°æ”¯æŒé…ç½®å®Œæˆ
- âœ… ç¤ºä¾‹ä»£ç ï¼ˆGreetingã€Platformï¼‰
- âœ… åŸºç¡€ UI ç»„ä»¶ï¼ˆApp.ktï¼‰
- âœ… æœåŠ¡å™¨åŸºç¡€è·¯ç”±

**å¾…å®Œå–„**ï¼š
- ä¸šåŠ¡åŠŸèƒ½å¼€å‘
- æ•°æ®æ¨¡å‹å®šä¹‰
- API æ¥å£è®¾è®¡
- çŠ¶æ€ç®¡ç†
- æ•°æ®æŒä¹…åŒ–

---

## å‚è€ƒèµ„æ–™

- [Kotlin Multiplatform æ–‡æ¡£](https://www.jetbrains.com/help/kotlin-multiplatform-dev/get-started.html)
- [Compose Multiplatform æ–‡æ¡£](https://github.com/JetBrains/compose-multiplatform)
- [Ktor æ–‡æ¡£](https://ktor.io/docs/welcome.html)
- [Kotlin/Wasm æ–‡æ¡£](https://kotl.in/wasm/)

---

*æœ€åæ›´æ–°ï¼š2024å¹´*
