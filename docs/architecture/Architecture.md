# HeartSave æ¶æ„è®¾è®¡æ–‡æ¡£

## ğŸ“‹ ç›®å½•

1. [æ¶æ„æ¦‚è¿°](#æ¶æ„æ¦‚è¿°)
2. [åˆ†å±‚æ¶æ„](#åˆ†å±‚æ¶æ„)
3. [ä¾èµ–å…³ç³»](#ä¾èµ–å…³ç³»)
4. [è®¾è®¡åŸåˆ™](#è®¾è®¡åŸåˆ™)
5. [æ¨¡å—èŒè´£](#æ¨¡å—èŒè´£)
6. [ä¾èµ–æ³¨å…¥ç­–ç•¥](#ä¾èµ–æ³¨å…¥ç­–ç•¥)
7. [æµ‹è¯•ç­–ç•¥](#æµ‹è¯•ç­–ç•¥)
8. [ä»£ç ç»„ç»‡](#ä»£ç ç»„ç»‡)
9. [æœ€ä½³å®è·µ](#æœ€ä½³å®è·µ)

---

## æ¶æ„æ¦‚è¿°

### æ ¸å¿ƒè®¾è®¡ç›®æ ‡

1. **ä½è€¦åˆ**ï¼šå„å±‚ä¹‹é—´é€šè¿‡æ¥å£é€šä¿¡ï¼Œå‡å°‘ç›´æ¥ä¾èµ–
2. **å¯æ›¿æ¢**ï¼šä»»ä½•å®ç°éƒ½å¯ä»¥è¢«æ›¿æ¢ï¼Œä¸å½±å“å…¶ä»–å±‚
3. **é«˜æµ‹è¯•æ€§**ï¼šæ¯å±‚éƒ½å¯ä»¥ç‹¬ç«‹æµ‹è¯•ï¼Œä½¿ç”¨ Mock å¯¹è±¡

### æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Presentation Layer                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  composeApp/                                          â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ UI Components (Compose)                           â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ ViewModels                                       â”‚ â”‚
â”‚  â”‚  â””â”€â”€ Navigation                                       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚ ä¾èµ–æ¥å£
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Domain Layer                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  shared/src/commonMain/domain/                       â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ UseCases (ä¸šåŠ¡ç”¨ä¾‹)                              â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ Models (é¢†åŸŸæ¨¡å‹)                                â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ Repository Interfaces (ä»“åº“æ¥å£)                 â”‚ â”‚
â”‚  â”‚  â””â”€â”€ Business Rules (ä¸šåŠ¡è§„åˆ™)                        â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚ ä¾èµ–æ¥å£
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       Data Layer                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  shared/src/commonMain/data/                         â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ Repository Implementations (ä»“åº“å®ç°)            â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ Data Sources (æ•°æ®æºæ¥å£)                        â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ DTOs (æ•°æ®ä¼ è¾“å¯¹è±¡)                              â”‚ â”‚
â”‚  â”‚  â””â”€â”€ Mappers (æ•°æ®æ˜ å°„)                               â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚ ä¾èµ–æ¥å£
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Platform Layer                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  shared/src/{platform}Main/                          â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ Network (ç½‘ç»œå®ç°)                               â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ Storage (å­˜å‚¨å®ç°)                               â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ File System (æ–‡ä»¶ç³»ç»Ÿ)                           â”‚ â”‚
â”‚  â”‚  â””â”€â”€ Device APIs (è®¾å¤‡ API)                           â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## åˆ†å±‚æ¶æ„

### 1. Presentation Layer (è¡¨ç°å±‚)

**ä½ç½®**ï¼š`composeApp/src/commonMain/kotlin/`

**èŒè´£**ï¼š
- UI ç»„ä»¶æ¸²æŸ“ï¼ˆComposeï¼‰
- ç”¨æˆ·äº¤äº’å¤„ç†
- UI çŠ¶æ€ç®¡ç†ï¼ˆViewModelï¼‰
- å¯¼èˆªé€»è¾‘

**è®¾è®¡åŸåˆ™**ï¼š
- âœ… **åªä¾èµ– Domain Layer çš„æ¥å£**
- âœ… **ä¸åŒ…å«ä¸šåŠ¡é€»è¾‘**
- âœ… **é€šè¿‡ ViewModel è®¿é—®ä¸šåŠ¡é€»è¾‘**
- âœ… **UI ç»„ä»¶åº”è¯¥æ˜¯çº¯å‡½æ•°å¼ç»„ä»¶**

**åŒ…ç»“æ„**ï¼š
```
composeApp/src/commonMain/kotlin/com/tcm/heartsave/
â”œâ”€â”€ ui/
â”‚   â”œâ”€â”€ components/          # å¯å¤ç”¨çš„ UI ç»„ä»¶
â”‚   â”œâ”€â”€ screens/             # å±å¹•çº§ç»„ä»¶
â”‚   â””â”€â”€ theme/               # ä¸»é¢˜é…ç½®
â”œâ”€â”€ viewmodel/               # ViewModel ç±»
â”‚   â”œâ”€â”€ HomeViewModel.kt
â”‚   â””â”€â”€ ProfileViewModel.kt
â””â”€â”€ navigation/              # å¯¼èˆªé…ç½®
    â””â”€â”€ NavGraph.kt
```

**ç¤ºä¾‹ä»£ç **ï¼š
```kotlin
// composeApp/src/commonMain/kotlin/com/tcm/heartsave/viewmodel/HomeViewModel.kt
class HomeViewModel(
    private val getUserUseCase: GetUserUseCase  // ä¾èµ– Domain Layer æ¥å£
) : ViewModel() {
    private val _uiState = MutableStateFlow(HomeUiState())
    val uiState: StateFlow<HomeUiState> = _uiState.asStateFlow()
    
    fun loadUser() {
        viewModelScope.launch {
            _uiState.update { it.copy(isLoading = true) }
            try {
                val user = getUserUseCase.invoke(userId)
                _uiState.update { it.copy(user = user, isLoading = false) }
            } catch (e: Exception) {
                _uiState.update { it.copy(error = e.message, isLoading = false) }
            }
        }
    }
}

// composeApp/src/commonMain/kotlin/com/tcm/heartsave/ui/screens/HomeScreen.kt
@Composable
fun HomeScreen(
    viewModel: HomeViewModel = viewModel()
) {
    val uiState by viewModel.uiState.collectAsState()
    
    when {
        uiState.isLoading -> LoadingIndicator()
        uiState.error != null -> ErrorMessage(uiState.error)
        else -> UserContent(uiState.user)
    }
}
```

**æµ‹è¯•æ€§**ï¼š
- âœ… ViewModel å¯ä»¥æ³¨å…¥ Mock UseCase è¿›è¡Œæµ‹è¯•
- âœ… UI ç»„ä»¶å¯ä»¥ç‹¬ç«‹æµ‹è¯•ï¼Œä¸ä¾èµ–çœŸå® ViewModel

---

### 2. Domain Layer (é¢†åŸŸå±‚)

**ä½ç½®**ï¼š`shared/src/commonMain/kotlin/domain/`

**èŒè´£**ï¼š
- ä¸šåŠ¡é€»è¾‘å°è£…ï¼ˆUseCaseï¼‰
- é¢†åŸŸæ¨¡å‹å®šä¹‰
- ä¸šåŠ¡è§„åˆ™éªŒè¯
- Repository æ¥å£å®šä¹‰ï¼ˆä¾èµ–å€’ç½®ï¼‰

**è®¾è®¡åŸåˆ™**ï¼š
- âœ… **ä¸ä¾èµ–ä»»ä½•å…¶ä»–å±‚**
- âœ… **åªå®šä¹‰æ¥å£ï¼Œä¸åŒ…å«å®ç°**
- âœ… **åŒ…å«æ ¸å¿ƒä¸šåŠ¡é€»è¾‘**
- âœ… **ä½¿ç”¨ UseCase æ¨¡å¼å°è£…ä¸šåŠ¡ç”¨ä¾‹**

**åŒ…ç»“æ„**ï¼š
```
shared/src/commonMain/kotlin/com/tcm/heartsave/domain/
â”œâ”€â”€ model/                   # é¢†åŸŸæ¨¡å‹
â”‚   â”œâ”€â”€ User.kt
â”‚   â””â”€â”€ Product.kt
â”œâ”€â”€ repository/              # Repository æ¥å£ï¼ˆä¾èµ–å€’ç½®ï¼‰
â”‚   â”œâ”€â”€ UserRepository.kt
â”‚   â””â”€â”€ ProductRepository.kt
â”œâ”€â”€ usecase/                 # UseCase ç±»
â”‚   â”œâ”€â”€ GetUserUseCase.kt
â”‚   â”œâ”€â”€ CreateUserUseCase.kt
â”‚   â””â”€â”€ UpdateUserUseCase.kt
â””â”€â”€ exception/               # é¢†åŸŸå¼‚å¸¸
    â””â”€â”€ DomainException.kt
```

**ç¤ºä¾‹ä»£ç **ï¼š
```kotlin
// shared/src/commonMain/kotlin/com/tcm/heartsave/domain/model/User.kt
data class User(
    val id: String,
    val name: String,
    val email: String,
    val createdAt: Long
) {
    init {
        require(name.isNotBlank()) { "ç”¨æˆ·åä¸èƒ½ä¸ºç©º" }
        require(email.contains("@")) { "é‚®ç®±æ ¼å¼ä¸æ­£ç¡®" }
    }
}

// shared/src/commonMain/kotlin/com/tcm/heartsave/domain/repository/UserRepository.kt
interface UserRepository {
    suspend fun getUserById(id: String): Result<User>
    suspend fun createUser(user: User): Result<Unit>
    suspend fun updateUser(user: User): Result<Unit>
    suspend fun deleteUser(id: String): Result<Unit>
}

// shared/src/commonMain/kotlin/com/tcm/heartsave/domain/usecase/GetUserUseCase.kt
class GetUserUseCase(
    private val userRepository: UserRepository  // ä¾èµ–æ¥å£ï¼Œä¸ä¾èµ–å®ç°
) {
    suspend operator fun invoke(userId: String): User {
        return userRepository.getUserById(userId)
            .getOrElse { throw UserNotFoundException(userId) }
    }
}

// shared/src/commonMain/kotlin/com/tcm/heartsave/domain/usecase/CreateUserUseCase.kt
class CreateUserUseCase(
    private val userRepository: UserRepository
) {
    suspend operator fun invoke(name: String, email: String): Result<User> {
        // ä¸šåŠ¡è§„åˆ™éªŒè¯
        if (name.isBlank()) {
            return Result.failure(ValidationException("ç”¨æˆ·åä¸èƒ½ä¸ºç©º"))
        }
        if (!email.contains("@")) {
            return Result.failure(ValidationException("é‚®ç®±æ ¼å¼ä¸æ­£ç¡®"))
        }
        
        val user = User(
            id = generateId(),
            name = name,
            email = email,
            createdAt = currentTimeMillis()
        )
        
        return userRepository.createUser(user)
    }
}
```

**æµ‹è¯•æ€§**ï¼š
- âœ… UseCase å¯ä»¥æ³¨å…¥ Mock Repository è¿›è¡Œæµ‹è¯•
- âœ… ä¸šåŠ¡é€»è¾‘å¯ä»¥å®Œå…¨ç‹¬ç«‹æµ‹è¯•ï¼Œä¸ä¾èµ–å¤–éƒ¨
- âœ… é¢†åŸŸæ¨¡å‹å¯ä»¥ç‹¬ç«‹éªŒè¯

---

### 3. Data Layer (æ•°æ®å±‚)

**ä½ç½®**ï¼š`shared/src/commonMain/kotlin/data/`

**èŒè´£**ï¼š
- Repository æ¥å£çš„å®ç°
- æ•°æ®æºæŠ½è±¡ï¼ˆRemoteã€Localï¼‰
- DTO ä¸ Domain Model çš„è½¬æ¢
- æ•°æ®ç¼“å­˜ç­–ç•¥

**è®¾è®¡åŸåˆ™**ï¼š
- âœ… **å®ç° Domain Layer å®šä¹‰çš„æ¥å£**
- âœ… **ä¾èµ– Platform Layer çš„æ¥å£**
- âœ… **å¤„ç†æ•°æ®è½¬æ¢ï¼ˆDTO â†” Domain Modelï¼‰**
- âœ… **å¯ä»¥åŒ…å«å¤šä¸ªæ•°æ®æºï¼ˆRemoteã€Localã€Cacheï¼‰**

**åŒ…ç»“æ„**ï¼š
```
shared/src/commonMain/kotlin/com/tcm/heartsave/data/
â”œâ”€â”€ repository/              # Repository å®ç°
â”‚   â””â”€â”€ UserRepositoryImpl.kt
â”œâ”€â”€ datasource/              # æ•°æ®æºæ¥å£å’Œå®ç°
â”‚   â”œâ”€â”€ remote/             # è¿œç¨‹æ•°æ®æº
â”‚   â”‚   â”œâ”€â”€ UserRemoteDataSource.kt
â”‚   â”‚   â””â”€â”€ UserApi.kt
â”‚   â”œâ”€â”€ local/              # æœ¬åœ°æ•°æ®æº
â”‚   â”‚   â””â”€â”€ UserLocalDataSource.kt
â”‚   â””â”€â”€ cache/              # ç¼“å­˜æ•°æ®æº
â”‚       â””â”€â”€ UserCacheDataSource.kt
â”œâ”€â”€ dto/                    # æ•°æ®ä¼ è¾“å¯¹è±¡
â”‚   â””â”€â”€ UserDto.kt
â””â”€â”€ mapper/                 # æ•°æ®æ˜ å°„å™¨
    â””â”€â”€ UserMapper.kt
```

**ç¤ºä¾‹ä»£ç **ï¼š
```kotlin
// shared/src/commonMain/kotlin/com/tcm/heartsave/data/dto/UserDto.kt
@Serializable
data class UserDto(
    val id: String,
    val name: String,
    val email: String,
    @SerialName("created_at") val createdAt: Long
)

// shared/src/commonMain/kotlin/com/tcm/heartsave/data/mapper/UserMapper.kt
object UserMapper {
    fun UserDto.toDomain(): User {
        return User(
            id = id,
            name = name,
            email = email,
            createdAt = createdAt
        )
    }
    
    fun User.toDto(): UserDto {
        return UserDto(
            id = id,
            name = name,
            email = email,
            createdAt = createdAt
        )
    }
}

// shared/src/commonMain/kotlin/com/tcm/heartsave/data/datasource/remote/UserRemoteDataSource.kt
interface UserRemoteDataSource {
    suspend fun getUserById(id: String): Result<UserDto>
    suspend fun createUser(userDto: UserDto): Result<UserDto>
}

// shared/src/commonMain/kotlin/com/tcm/heartsave/data/datasource/local/UserLocalDataSource.kt
interface UserLocalDataSource {
    suspend fun getUserById(id: String): UserDto?
    suspend fun saveUser(userDto: UserDto)
    suspend fun deleteUser(id: String)
}

// shared/src/commonMain/kotlin/com/tcm/heartsave/data/repository/UserRepositoryImpl.kt
class UserRepositoryImpl(
    private val remoteDataSource: UserRemoteDataSource,  // ä¾èµ–æ¥å£
    private val localDataSource: UserLocalDataSource,   // ä¾èµ–æ¥å£
    private val mapper: UserMapper = UserMapper()
) : UserRepository {  // å®ç° Domain Layer çš„æ¥å£
    
    override suspend fun getUserById(id: String): Result<User> {
        // 1. å…ˆå°è¯•ä»æœ¬åœ°è·å–
        localDataSource.getUserById(id)?.let { dto ->
            return Result.success(mapper.toDomain(dto))
        }
        
        // 2. ä»è¿œç¨‹è·å–
        return remoteDataSource.getUserById(id)
            .map { dto ->
                // 3. ä¿å­˜åˆ°æœ¬åœ°
                localDataSource.saveUser(dto)
                mapper.toDomain(dto)
            }
    }
    
    override suspend fun createUser(user: User): Result<Unit> {
        return remoteDataSource.createUser(mapper.toDto(user))
            .map { dto ->
                localDataSource.saveUser(dto)
            }
    }
    
    override suspend fun updateUser(user: User): Result<Unit> {
        // å®ç°æ›´æ–°é€»è¾‘
        return Result.success(Unit)
    }
    
    override suspend fun deleteUser(id: String): Result<Unit> {
        // å®ç°åˆ é™¤é€»è¾‘
        return Result.success(Unit)
    }
}
```

**æµ‹è¯•æ€§**ï¼š
- âœ… Repository å®ç°å¯ä»¥æ³¨å…¥ Mock DataSource è¿›è¡Œæµ‹è¯•
- âœ… æ•°æ®è½¬æ¢é€»è¾‘å¯ä»¥ç‹¬ç«‹æµ‹è¯•
- âœ… å¯ä»¥æµ‹è¯•ä¸åŒæ•°æ®æºçš„ç»„åˆç­–ç•¥

---

### 4. Platform Layer (å¹³å°å±‚)

**ä½ç½®**ï¼š`shared/src/{platform}Main/kotlin/`

**èŒè´£**ï¼š
- å¹³å°ç‰¹å®šçš„ API å®ç°
- ç½‘ç»œè¯·æ±‚å®ç°
- æœ¬åœ°å­˜å‚¨å®ç°
- æ–‡ä»¶ç³»ç»Ÿæ“ä½œ
- è®¾å¤‡åŠŸèƒ½è®¿é—®

**è®¾è®¡åŸåˆ™**ï¼š
- âœ… **å®ç° Data Layer å®šä¹‰çš„æ¥å£**
- âœ… **ä½¿ç”¨ expect/actual æœºåˆ¶**
- âœ… **å°è£…å¹³å°ç‰¹å®šç»†èŠ‚**
- âœ… **æä¾›ç»Ÿä¸€çš„æ¥å£ç»™ä¸Šå±‚ä½¿ç”¨**

**åŒ…ç»“æ„**ï¼š
```
shared/src/{platform}Main/kotlin/com/tcm/heartsave/platform/
â”œâ”€â”€ network/                # ç½‘ç»œå®ç°
â”‚   â”œâ”€â”€ HttpClient.kt
â”‚   â””â”€â”€ NetworkClient.kt
â”œâ”€â”€ storage/                # å­˜å‚¨å®ç°
â”‚   â”œâ”€â”€ KeyValueStorage.kt
â”‚   â””â”€â”€ DatabaseStorage.kt
â””â”€â”€ file/                   # æ–‡ä»¶ç³»ç»Ÿ
    â””â”€â”€ FileManager.kt
```

**ç¤ºä¾‹ä»£ç **ï¼š
```kotlin
// shared/src/commonMain/kotlin/com/tcm/heartsave/platform/network/NetworkClient.kt
expect class NetworkClient {
    suspend fun get(url: String): String
    suspend fun post(url: String, body: String): String
}

// shared/src/androidMain/kotlin/com/tcm/heartsave/platform/network/NetworkClient.android.kt
actual class NetworkClient actual constructor() {
    private val client = OkHttpClient()
    
    actual suspend fun get(url: String): String = suspendCancellableCoroutine { continuation ->
        val request = Request.Builder().url(url).build()
        client.newCall(request).enqueue(object : Callback {
            override fun onResponse(call: Call, response: Response) {
                continuation.resume(response.body?.string() ?: "")
            }
            override fun onFailure(call: Call, e: IOException) {
                continuation.resumeWithException(e)
            }
        })
    }
    
    actual suspend fun post(url: String, body: String): String {
        // Android å®ç°
    }
}

// shared/src/iosMain/kotlin/com/tcm/heartsave/platform/network/NetworkClient.ios.kt
actual class NetworkClient actual constructor() {
    actual suspend fun get(url: String): String {
        // iOS URLSession å®ç°
    }
    
    actual suspend fun post(url: String, body: String): String {
        // iOS å®ç°
    }
}

// shared/src/commonMain/kotlin/com/tcm/heartsave/platform/storage/KeyValueStorage.kt
expect class KeyValueStorage {
    suspend fun put(key: String, value: String)
    suspend fun get(key: String): String?
    suspend fun remove(key: String)
}

// shared/src/androidMain/kotlin/com/tcm/heartsave/platform/storage/KeyValueStorage.android.kt
actual class KeyValueStorage actual constructor() {
    private val prefs = context.getSharedPreferences("app_prefs", Context.MODE_PRIVATE)
    
    actual suspend fun put(key: String, value: String) {
        prefs.edit().putString(key, value).apply()
    }
    
    actual suspend fun get(key: String): String? {
        return prefs.getString(key, null)
    }
    
    actual suspend fun remove(key: String) {
        prefs.edit().remove(key).apply()
    }
}
```

**æµ‹è¯•æ€§**ï¼š
- âœ… å¹³å°å®ç°å¯ä»¥åœ¨å„å¹³å°ç‹¬ç«‹æµ‹è¯•
- âœ… å¯ä»¥é€šè¿‡ Mock æ›¿æ¢å¹³å°å®ç°è¿›è¡Œæµ‹è¯•

---

## ä¾èµ–å…³ç³»

### ä¾èµ–æ–¹å‘è§„åˆ™

```
Presentation Layer
    â†“ (ä¾èµ–)
Domain Layer
    â†“ (ä¾èµ–)
Data Layer
    â†“ (ä¾èµ–)
Platform Layer
```

**å…³é”®åŸåˆ™**ï¼š
- âœ… **å•å‘ä¾èµ–**ï¼šä¸Šå±‚ä¾èµ–ä¸‹å±‚ï¼Œä¸‹å±‚ä¸ä¾èµ–ä¸Šå±‚
- âœ… **æ¥å£ä¾èµ–**ï¼šæ‰€æœ‰ä¾èµ–éƒ½é€šè¿‡æ¥å£ï¼Œä¸ä¾èµ–å…·ä½“å®ç°
- âœ… **ä¾èµ–å€’ç½®**ï¼šDomain Layer å®šä¹‰æ¥å£ï¼ŒData Layer å®ç°æ¥å£

### ä¾èµ–æ³¨å…¥

**æ¨èæ–¹å¼**ï¼šæ„é€ å‡½æ•°æ³¨å…¥

```kotlin
// âœ… å¥½çš„åšæ³•ï¼šé€šè¿‡æ„é€ å‡½æ•°æ³¨å…¥
class GetUserUseCase(
    private val userRepository: UserRepository  // æ¥å£ç±»å‹
)

// âŒ é¿å…ï¼šç›´æ¥åˆ›å»ºä¾èµ–
class GetUserUseCase {
    private val userRepository = UserRepositoryImpl()  // å…·ä½“å®ç°
}

// âŒ é¿å…ï¼šä½¿ç”¨å•ä¾‹æˆ–å…¨å±€å˜é‡
object UserRepositorySingleton  // éš¾ä»¥æµ‹è¯•å’Œæ›¿æ¢
```

---

## è®¾è®¡åŸåˆ™

### 1. å•ä¸€èŒè´£åŸåˆ™ (SRP)

æ¯ä¸ªç±»/æ¨¡å—åªè´Ÿè´£ä¸€ä¸ªèŒè´£ï¼š

```kotlin
// âœ… å¥½çš„åšæ³•ï¼šèŒè´£åˆ†ç¦»
class GetUserUseCase { }  // åªè´Ÿè´£è·å–ç”¨æˆ·
class CreateUserUseCase { }  // åªè´Ÿè´£åˆ›å»ºç”¨æˆ·

// âŒ é¿å…ï¼šèŒè´£æ··åˆ
class UserUseCase {  // åŒ…å«æ‰€æœ‰ç”¨æˆ·ç›¸å…³æ“ä½œ
    fun getUser() { }
    fun createUser() { }
    fun updateUser() { }
    fun deleteUser() { }
}
```

### 2. ä¾èµ–å€’ç½®åŸåˆ™ (DIP)

é«˜å±‚æ¨¡å—ä¸ä¾èµ–ä½å±‚æ¨¡å—ï¼Œéƒ½ä¾èµ–æŠ½è±¡ï¼š

```kotlin
// âœ… å¥½çš„åšæ³•ï¼šDomain Layer å®šä¹‰æ¥å£
// domain/repository/UserRepository.kt
interface UserRepository { }

// data/repository/UserRepositoryImpl.kt
class UserRepositoryImpl : UserRepository { }

// âŒ é¿å…ï¼šDomain Layer ä¾èµ–å…·ä½“å®ç°
class GetUserUseCase(
    private val repository: UserRepositoryImpl  // ä¾èµ–å…·ä½“å®ç°
)
```

### 3. æ¥å£éš”ç¦»åŸåˆ™ (ISP)

æ¥å£åº”è¯¥å°è€Œä¸“ä¸€ï¼š

```kotlin
// âœ… å¥½çš„åšæ³•ï¼šæ¥å£åˆ†ç¦»
interface UserReader {
    suspend fun getUser(id: String): User
}

interface UserWriter {
    suspend fun createUser(user: User)
    suspend fun updateUser(user: User)
}

// âŒ é¿å…ï¼šå¤§è€Œå…¨çš„æ¥å£
interface UserRepository {
    suspend fun getUser(id: String): User
    suspend fun createUser(user: User)
    suspend fun updateUser(user: User)
    suspend fun deleteUser(id: String)
    suspend fun getAllUsers(): List<User>
    suspend fun searchUsers(query: String): List<User>
    // ... å¤ªå¤šæ–¹æ³•
}
```

### 4. å¼€é—­åŸåˆ™ (OCP)

å¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­ï¼š

```kotlin
// âœ… å¥½çš„åšæ³•ï¼šé€šè¿‡æ¥å£æ‰©å±•
interface UserRepository { }
class DatabaseUserRepository : UserRepository { }
class ApiUserRepository : UserRepository { }  // æ–°å¢å®ç°ï¼Œä¸éœ€è¦ä¿®æ”¹ç°æœ‰ä»£ç 

// âŒ é¿å…ï¼šä¿®æ”¹ç°æœ‰ä»£ç æ¥æ”¯æŒæ–°åŠŸèƒ½
class UserRepository {
    fun getUser(source: String) {  // é€šè¿‡å‚æ•°æ‰©å±•
        when (source) {
            "database" -> { }
            "api" -> { }  // æ–°å¢æ—¶éœ€è¦ä¿®æ”¹ä»£ç 
        }
    }
}
```

---

## æ¨¡å—èŒè´£

### composeApp æ¨¡å—

**èŒè´£**ï¼š
- UI æ¸²æŸ“
- ç”¨æˆ·äº¤äº’
- ViewModel ç®¡ç†
- å¯¼èˆª

**ä¾èµ–**ï¼š
- Domain Layer (UseCase æ¥å£)
- Compose Multiplatform
- Material3

**ä¸åŒ…å«**ï¼š
- âŒ ä¸šåŠ¡é€»è¾‘
- âŒ æ•°æ®è®¿é—®ä»£ç 
- âŒ å¹³å°ç‰¹å®šä»£ç ï¼ˆé™¤äº†å…¥å£ç‚¹ï¼‰

### shared æ¨¡å—

**èŒè´£**ï¼š
- Domain Layerï¼ˆä¸šåŠ¡é€»è¾‘ï¼‰
- Data Layerï¼ˆæ•°æ®è®¿é—®ï¼‰
- Platform Layerï¼ˆå¹³å°æŠ½è±¡ï¼‰

**ä¾èµ–**ï¼š
- Kotlin æ ‡å‡†åº“
- Coroutines
- Serializationï¼ˆå¦‚éœ€è¦ï¼‰

**ä¸åŒ…å«**ï¼š
- âŒ UI ä»£ç 
- âŒ å¹³å°ç‰¹å®šçš„ UI æ¡†æ¶

### server æ¨¡å—

**èŒè´£**ï¼š
- API ç«¯ç‚¹
- è·¯ç”±é…ç½®
- æœåŠ¡å™¨ä¸­é—´ä»¶

**ä¾èµ–**ï¼š
- Ktor
- shared æ¨¡å—ï¼ˆå…±äº«ä¸šåŠ¡é€»è¾‘ï¼‰

---

## ä¾èµ–æ³¨å…¥ç­–ç•¥

### æ¨èæ–¹æ¡ˆï¼šæ‰‹åŠ¨ä¾èµ–æ³¨å…¥

**ä¼˜ç‚¹**ï¼š
- âœ… æ— éœ€é¢å¤–ä¾èµ–
- âœ… ç¼–è¯‘æ—¶å®‰å…¨
- âœ… æ˜“äºç†è§£

**å®ç°æ–¹å¼**ï¼š

```kotlin
// shared/src/commonMain/kotlin/com/tcm/heartsave/di/AppContainer.kt
class AppContainer {
    // Platform Layer
    private val networkClient: NetworkClient = NetworkClient()
    private val storage: KeyValueStorage = KeyValueStorage()
    
    // Data Layer
    private val userRemoteDataSource: UserRemoteDataSource = 
        UserRemoteDataSourceImpl(networkClient)
    private val userLocalDataSource: UserLocalDataSource = 
        UserLocalDataSourceImpl(storage)
    private val userRepository: UserRepository = 
        UserRepositoryImpl(userRemoteDataSource, userLocalDataSource)
    
    // Domain Layer
    val getUserUseCase: GetUserUseCase = GetUserUseCase(userRepository)
    val createUserUseCase: CreateUserUseCase = CreateUserUseCase(userRepository)
}

// composeApp/src/commonMain/kotlin/com/tcm/heartsave/App.kt
@Composable
fun App() {
    val container = remember { AppContainer() }
    
    MaterialTheme {
        NavGraph(
            getUserUseCase = container.getUserUseCase,
            createUserUseCase = container.createUserUseCase
        )
    }
}
```

### å¯é€‰æ–¹æ¡ˆï¼šKoinï¼ˆå¦‚æœéœ€è¦ï¼‰

å¦‚æœé¡¹ç›®å¤æ‚åº¦å¢åŠ ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨ Koinï¼š

```kotlin
// æ·»åŠ  Koin ä¾èµ–
val koinVersion = "3.5.0"

// å®šä¹‰æ¨¡å—
val appModule = module {
    // Platform
    single<NetworkClient> { NetworkClient() }
    single<KeyValueStorage> { KeyValueStorage() }
    
    // Data
    single<UserRemoteDataSource> { UserRemoteDataSourceImpl(get()) }
    single<UserLocalDataSource> { UserLocalDataSourceImpl(get()) }
    single<UserRepository> { UserRepositoryImpl(get(), get()) }
    
    // Domain
    factory<GetUserUseCase> { GetUserUseCase(get()) }
    factory<CreateUserUseCase> { CreateUserUseCase(get()) }
}

// åˆå§‹åŒ–
startKoin {
    modules(appModule)
}

// ä½¿ç”¨
class HomeViewModel : ViewModel() {
    private val getUserUseCase: GetUserUseCase by inject()
}
```

---

## æµ‹è¯•ç­–ç•¥

### 1. Domain Layer æµ‹è¯•

**ç›®æ ‡**ï¼šæµ‹è¯•ä¸šåŠ¡é€»è¾‘ï¼Œä¸ä¾èµ–å¤–éƒ¨

```kotlin
// shared/src/commonTest/kotlin/com/tcm/heartsave/domain/usecase/GetUserUseCaseTest.kt
class GetUserUseCaseTest {
    @Test
    fun `should return user when repository returns success`() = runTest {
        // Given
        val mockRepository = mockk<UserRepository>()
        val expectedUser = User(id = "1", name = "Test", email = "test@test.com", createdAt = 0)
        every { mockRepository.getUserById("1") } returns Result.success(expectedUser)
        
        val useCase = GetUserUseCase(mockRepository)
        
        // When
        val result = useCase("1")
        
        // Then
        assertEquals(expectedUser, result)
        verify { mockRepository.getUserById("1") }
    }
    
    @Test
    fun `should throw exception when repository returns failure`() = runTest {
        // Given
        val mockRepository = mockk<UserRepository>()
        every { mockRepository.getUserById("1") } returns Result.failure(Exception("Not found"))
        
        val useCase = GetUserUseCase(mockRepository)
        
        // When & Then
        assertFailsWith<UserNotFoundException> {
            useCase("1")
        }
    }
}
```

### 2. Data Layer æµ‹è¯•

**ç›®æ ‡**ï¼šæµ‹è¯•æ•°æ®è½¬æ¢å’Œ Repository å®ç°

```kotlin
// shared/src/commonTest/kotlin/com/tcm/heartsave/data/repository/UserRepositoryImplTest.kt
class UserRepositoryImplTest {
    @Test
    fun `should return user from local when available`() = runTest {
        // Given
        val mockLocalDataSource = mockk<UserLocalDataSource>()
        val mockRemoteDataSource = mockk<UserRemoteDataSource>()
        val userDto = UserDto("1", "Test", "test@test.com", 0)
        
        every { mockLocalDataSource.getUserById("1") } returns userDto
        
        val repository = UserRepositoryImpl(mockRemoteDataSource, mockLocalDataSource)
        
        // When
        val result = repository.getUserById("1")
        
        // Then
        assertTrue(result.isSuccess)
        assertEquals("Test", result.getOrNull()?.name)
        verify(exactly = 0) { mockRemoteDataSource.getUserById(any()) }
    }
    
    @Test
    fun `should fetch from remote when local not available`() = runTest {
        // Given
        val mockLocalDataSource = mockk<UserLocalDataSource>()
        val mockRemoteDataSource = mockk<UserRemoteDataSource>()
        val userDto = UserDto("1", "Test", "test@test.com", 0)
        
        every { mockLocalDataSource.getUserById("1") } returns null
        every { mockRemoteDataSource.getUserById("1") } returns Result.success(userDto)
        every { mockLocalDataSource.saveUser(any()) } just Runs
        
        val repository = UserRepositoryImpl(mockRemoteDataSource, mockLocalDataSource)
        
        // When
        val result = repository.getUserById("1")
        
        // Then
        assertTrue(result.isSuccess)
        verify { mockRemoteDataSource.getUserById("1") }
        verify { mockLocalDataSource.saveUser(userDto) }
    }
}
```

### 3. Presentation Layer æµ‹è¯•

**ç›®æ ‡**ï¼šæµ‹è¯• ViewModel å’Œ UI é€»è¾‘

```kotlin
// composeApp/src/commonTest/kotlin/com/tcm/heartsave/viewmodel/HomeViewModelTest.kt
class HomeViewModelTest {
    @Test
    fun `should load user successfully`() = runTest {
        // Given
        val mockUseCase = mockk<GetUserUseCase>()
        val expectedUser = User("1", "Test", "test@test.com", 0)
        coEvery { mockUseCase("1") } returns expectedUser
        
        val viewModel = HomeViewModel(mockUseCase)
        
        // When
        viewModel.loadUser("1")
        
        // Then
        val state = viewModel.uiState.value
        assertEquals(expectedUser, state.user)
        assertFalse(state.isLoading)
        assertNull(state.error)
    }
    
    @Test
    fun `should handle error when use case fails`() = runTest {
        // Given
        val mockUseCase = mockk<GetUserUseCase>()
        coEvery { mockUseCase("1") } throws Exception("Network error")
        
        val viewModel = HomeViewModel(mockUseCase)
        
        // When
        viewModel.loadUser("1")
        
        // Then
        val state = viewModel.uiState.value
        assertNull(state.user)
        assertFalse(state.isLoading)
        assertEquals("Network error", state.error)
    }
}
```

### 4. é›†æˆæµ‹è¯•

**ç›®æ ‡**ï¼šæµ‹è¯•å¤šä¸ªå±‚çš„åä½œ

```kotlin
// shared/src/commonTest/kotlin/com/tcm/heartsave/integration/UserFlowTest.kt
class UserFlowIntegrationTest {
    @Test
    fun `should create and retrieve user`() = runTest {
        // Given: ä½¿ç”¨çœŸå®å®ç°ï¼ˆä½†å¯ä»¥æ›¿æ¢æ•°æ®æºï¼‰
        val storage = InMemoryKeyValueStorage()  // æµ‹è¯•ç”¨çš„å†…å­˜å­˜å‚¨
        val localDataSource = UserLocalDataSourceImpl(storage)
        val remoteDataSource = FakeUserRemoteDataSource()  // æµ‹è¯•ç”¨çš„å‡æ•°æ®æº
        val repository = UserRepositoryImpl(remoteDataSource, localDataSource)
        val createUseCase = CreateUserUseCase(repository)
        val getUserUseCase = GetUserUseCase(repository)
        
        // When: åˆ›å»ºç”¨æˆ·
        val createResult = createUseCase("Test User", "test@test.com")
        assertTrue(createResult.isSuccess)
        val user = createResult.getOrNull()!!
        
        // Then: å¯ä»¥è·å–ç”¨æˆ·
        val retrievedUser = getUserUseCase(user.id)
        assertEquals(user, retrievedUser)
    }
}
```

---

## ä»£ç ç»„ç»‡

### æ¨èçš„åŒ…ç»“æ„

```
shared/src/commonMain/kotlin/com/tcm/heartsave/
â”œâ”€â”€ domain/                  # é¢†åŸŸå±‚
â”‚   â”œâ”€â”€ model/              # é¢†åŸŸæ¨¡å‹
â”‚   â”œâ”€â”€ repository/         # Repository æ¥å£
â”‚   â”œâ”€â”€ usecase/            # UseCase
â”‚   â””â”€â”€ exception/          # é¢†åŸŸå¼‚å¸¸
â”œâ”€â”€ data/                   # æ•°æ®å±‚
â”‚   â”œâ”€â”€ repository/         # Repository å®ç°
â”‚   â”œâ”€â”€ datasource/         # æ•°æ®æº
â”‚   â”‚   â”œâ”€â”€ remote/         # è¿œç¨‹æ•°æ®æº
â”‚   â”‚   â”œâ”€â”€ local/          # æœ¬åœ°æ•°æ®æº
â”‚   â”‚   â””â”€â”€ cache/          # ç¼“å­˜æ•°æ®æº
â”‚   â”œâ”€â”€ dto/                # DTO
â”‚   â””â”€â”€ mapper/             # æ˜ å°„å™¨
â”œâ”€â”€ platform/               # å¹³å°å±‚ï¼ˆæ¥å£å®šä¹‰ï¼‰
â”‚   â”œâ”€â”€ network/            # ç½‘ç»œæ¥å£
â”‚   â”œâ”€â”€ storage/            # å­˜å‚¨æ¥å£
â”‚   â””â”€â”€ file/               # æ–‡ä»¶æ¥å£
â””â”€â”€ di/                     # ä¾èµ–æ³¨å…¥
    â””â”€â”€ AppContainer.kt

shared/src/{platform}Main/kotlin/com/tcm/heartsave/platform/
â”œâ”€â”€ network/                # ç½‘ç»œå®ç°
â”œâ”€â”€ storage/                # å­˜å‚¨å®ç°
â””â”€â”€ file/                   # æ–‡ä»¶å®ç°

composeApp/src/commonMain/kotlin/com/tcm/heartsave/
â”œâ”€â”€ ui/                     # UI ç»„ä»¶
â”‚   â”œâ”€â”€ components/         # å¯å¤ç”¨ç»„ä»¶
â”‚   â”œâ”€â”€ screens/            # å±å¹•
â”‚   â””â”€â”€ theme/              # ä¸»é¢˜
â”œâ”€â”€ viewmodel/              # ViewModel
â””â”€â”€ navigation/             # å¯¼èˆª
```

---

## æœ€ä½³å®è·µ

### âœ… åº”è¯¥åšçš„

1. **ä½¿ç”¨æ¥å£æŠ½è±¡**
   ```kotlin
   // âœ… å¥½çš„åšæ³•
   interface UserRepository { }
   class UserRepositoryImpl : UserRepository { }
   ```

2. **é€šè¿‡æ„é€ å‡½æ•°æ³¨å…¥ä¾èµ–**
   ```kotlin
   // âœ… å¥½çš„åšæ³•
   class GetUserUseCase(private val repository: UserRepository)
   ```

3. **ä½¿ç”¨ Result ç±»å‹å¤„ç†é”™è¯¯**
   ```kotlin
   // âœ… å¥½çš„åšæ³•
   suspend fun getUser(id: String): Result<User>
   ```

4. **åˆ†ç¦»å…³æ³¨ç‚¹**
   - UI åªè´Ÿè´£å±•ç¤º
   - UseCase åªè´Ÿè´£ä¸šåŠ¡é€»è¾‘
   - Repository åªè´Ÿè´£æ•°æ®è®¿é—®

5. **ç¼–å†™æµ‹è¯•**
   - æ¯å±‚éƒ½è¦æœ‰æµ‹è¯•
   - ä½¿ç”¨ Mock å¯¹è±¡éš”ç¦»ä¾èµ–

### âŒ ä¸åº”è¯¥åšçš„

1. **ä¸è¦ç›´æ¥ä¾èµ–å…·ä½“å®ç°**
   ```kotlin
   // âŒ é¿å…
   class GetUserUseCase(private val repository: UserRepositoryImpl)
   ```

2. **ä¸è¦åœ¨ Domain Layer ä¾èµ– Data Layer**
   ```kotlin
   // âŒ é¿å…
   // domain/usecase/GetUserUseCase.kt
   import com.tcm.heartsave.data.repository.UserRepositoryImpl
   ```

3. **ä¸è¦åœ¨ UI å±‚å†™ä¸šåŠ¡é€»è¾‘**
   ```kotlin
   // âŒ é¿å…
   @Composable
   fun HomeScreen() {
       val user = remember {
           // ä¸šåŠ¡é€»è¾‘ä¸åº”è¯¥åœ¨è¿™é‡Œ
           if (condition) { ... } else { ... }
       }
   }
   ```

4. **ä¸è¦ä½¿ç”¨å…¨å±€å˜é‡æˆ–å•ä¾‹**
   ```kotlin
   // âŒ é¿å…
   object UserRepositorySingleton {
       fun getUser() { }
   }
   ```

5. **ä¸è¦å¿½ç•¥é”™è¯¯å¤„ç†**
   ```kotlin
   // âŒ é¿å…
   suspend fun getUser(id: String): User {
       return repository.getUser(id)  // å¯èƒ½æŠ›å‡ºå¼‚å¸¸
   }
   
   // âœ… å¥½çš„åšæ³•
   suspend fun getUser(id: String): Result<User> {
       return repository.getUser(id)
   }
   ```

---

## æ€»ç»“

### æ¶æ„ä¼˜åŠ¿

1. **ä½è€¦åˆ**ï¼šé€šè¿‡æ¥å£å®ç°å±‚é—´è§£è€¦
2. **å¯æ›¿æ¢**ï¼šä»»ä½•å®ç°éƒ½å¯ä»¥è¢«æ›¿æ¢
3. **é«˜æµ‹è¯•æ€§**ï¼šæ¯å±‚éƒ½å¯ä»¥ç‹¬ç«‹æµ‹è¯•
4. **å¯ç»´æŠ¤æ€§**ï¼šæ¸…æ™°çš„èŒè´£åˆ’åˆ†
5. **å¯æ‰©å±•æ€§**ï¼šæ˜“äºæ·»åŠ æ–°åŠŸèƒ½

### å…³é”®è¦ç‚¹

- âœ… **ä¾èµ–å€’ç½®**ï¼šDomain Layer å®šä¹‰æ¥å£ï¼ŒData Layer å®ç°
- âœ… **å•å‘ä¾èµ–**ï¼šä¸Šå±‚ä¾èµ–ä¸‹å±‚ï¼Œé€šè¿‡æ¥å£
- âœ… **æ„é€ å‡½æ•°æ³¨å…¥**ï¼šæ‰€æœ‰ä¾èµ–é€šè¿‡æ„é€ å‡½æ•°æ³¨å…¥
- âœ… **æµ‹è¯•é©±åŠ¨**ï¼šæ¯å±‚éƒ½è¦æœ‰æµ‹è¯•

---

*æœ€åæ›´æ–°ï¼š2024å¹´*
